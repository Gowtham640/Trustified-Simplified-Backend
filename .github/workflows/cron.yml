name: Cron Job

on:
  schedule:
    # Run 20 times per day starting at 1:30 PM IST (8:00 AM UTC), every 72 minutes
    - cron: "0 8 * * *"      # 8:00 AM UTC = 1:30 PM IST (start)
    - cron: "12 9 * * *"     # 9:12 AM UTC = 2:42 PM IST (+72 min)
    - cron: "24 10 * * *"    # 10:24 AM UTC = 3:54 PM IST (+72 min)
    - cron: "36 11 * * *"    # 11:36 AM UTC = 5:06 PM IST (+72 min)
    - cron: "48 12 * * *"    # 12:48 PM UTC = 6:18 PM IST (+72 min)
    - cron: "0 14 * * *"     # 2:00 PM UTC = 7:30 PM IST (+72 min)
    - cron: "12 15 * * *"    # 3:12 PM UTC = 8:42 PM IST (+72 min)
    - cron: "24 16 * * *"    # 4:24 PM UTC = 9:54 PM IST (+72 min)
    - cron: "36 17 * * *"    # 5:36 PM UTC = 11:06 PM IST (+72 min)
    - cron: "48 18 * * *"    # 6:48 PM UTC = 12:18 AM IST (+72 min)
    - cron: "0 20 * * *"     # 8:00 PM UTC = 1:30 AM IST (+72 min)
    - cron: "12 21 * * *"    # 9:12 PM UTC = 2:42 AM IST (+72 min)
    - cron: "24 22 * * *"    # 10:24 PM UTC = 3:54 AM IST (+72 min)
    - cron: "36 23 * * *"    # 11:36 PM UTC = 5:06 AM IST (+72 min)
    - cron: "48 0 * * *"     # 12:48 AM UTC = 6:18 AM IST (+72 min)
    - cron: "0 2 * * *"      # 2:00 AM UTC = 7:30 AM IST (+72 min)
    - cron: "12 3 * * *"     # 3:12 AM UTC = 8:42 AM IST (+72 min)
    - cron: "24 4 * * *"     # 4:24 AM UTC = 9:54 AM IST (+72 min)
    - cron: "36 5 * * *"     # 5:36 AM UTC = 11:06 AM IST (+72 min)
    - cron: "48 6 * * *"     # 6:48 AM UTC = 12:18 PM IST (+72 min)
  workflow_dispatch:         # manual run

jobs:
  run-cron:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run cron job
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          ANON_KEY: ${{ secrets.ANON_KEY }}
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          CUSTOM_SEARCH_API_KEY: ${{ secrets.CUSTOM_SEARCH_API_KEY }}
          CUSTOM_SEARCH_ENGINE_ID: ${{ secrets.CUSTOM_SEARCH_ENGINE_ID }}
        run: |
          python cron_job.py
